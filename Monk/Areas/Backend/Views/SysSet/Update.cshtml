@model SysSetViewModel
@{
    ViewBag.Title = "系统设置";
    Layout = "~/Areas/Backend/Views/Shared/_Form.cshtml";
}

@section crumbs{
    <label class="backend-crumbs-separator">/</label>
    <a href="#" title="系统管理">系统管理</a>
    <label class="backend-crumbs-separator">/</label>
    <a href="#" title="系统设置">系统设置</a>
    <label class="backend-crumbs-separator">/</label>
    <a href="#" title="更新设置">更新设置</a>
}

@section beginForm{@{ Html.BeginForm("Update", "SysSet", FormMethod.Post, new { @class = "monk-form" });}}

<div class="monk-form-item">
    <label for="Logo" class="monk-form-label">系统标志</label>
    <div class="monk-form-wrap noborder">
        <img src="@Model.Logo" alt="" class="display-block" height="50" />
    </div>
    <div class="clear-both height-8"></div>
    <div class="monk-form-wrap monk-form-image-wrap">
        <div class="monk-images-selects">
        </div>
        <div class="monk-form-wrap bgcolor-white">
            <span class="monk-iconfont border-right icon-monk-input"></span>
            @Html.TextBoxFor(u => u.Logo,
            new
            {
                @class = "monk-form-input normal",
                placeholder = "系统标志",
                datatype = "*",
                errormsg = "系统标志必须是路径格式",
                nullmsg = "请选择或输入图片地址作为系统标志"
            })
            <span class="monk-iconfont icon-monk-required"></span>
            <span class="monk-iconfont border-left icon-monk-file"></span>
        </div>
        <div class="monk-file-uploadProgress" id="uploadProgress"></div>
        <div class="monk-input-button" id="selectFiles">选择图片</div>
        <div class="monk-input-button emerland" id="startUpload">开始上传</div>
    </div>
    <div class="monk-form-tip">选择你喜欢的图片作为系统标志</div>
</div>
<div class="monk-form-item">
    <label for="Name" class="monk-form-label">系统名称</label>
    <div class="monk-form-wrap">
        <span class="monk-iconfont border-right icon-monk-input"></span>
        @Html.TextBoxFor(u => u.Name,
        new
        {
            @class = "monk-form-input normal",
            placeholder = "系统名称",
            datatype = "*1-50",
            errormsg = "系统名称由6-20位英文字母、数字或符号组成",
            nullmsg = "请输入系统名称"
        })
        <span class="monk-iconfont icon-monk-required"></span>
        <span class="monk-iconfont border-left icon-monk-dacha monk-clear-input"></span>
    </div>
    <div class="monk-form-tip">给你的系统起个牛逼的名字吧</div>
</div>
<div class="monk-form-item">
    <label for="Version" class="monk-form-label">系统版本</label>
    <div class="monk-form-wrap">
        <span class="monk-iconfont border-right icon-monk-input"></span>
        @Html.TextBoxFor(u => u.Version,
        new
        {
            @class = "monk-form-input middle",
            placeholder = "系统版本",
            datatype = "*1-25",
            errormsg = "系统版本由6-20位英文字母、数字或符号组成",
            nullmsg = "请输入系统版本"
        })
        <span class="monk-iconfont icon-monk-required"></span>
        <span class="monk-iconfont border-left icon-monk-dacha monk-clear-input"></span>
    </div>
    <div class="monk-form-tip">通常系统版本格式为：v1.0.0</div>
</div>
<div class="monk-form-item">
    <label for="Keywords" class="monk-form-label">关键字</label>
    <div class="monk-form-wrap">
        <span class="monk-iconfont border-right icon-monk-input textarea-icon"></span>
        @Html.TextAreaFor(u => u.Keywords,
        new
        {
            @class = "monk-form-textarea normal",
            placeholder = "关键字",
            datatype = "*1-100",
            ignore = "ignore",
            errormsg = "关键字由1-100位英文字母、数字或符号组成",
            nullmsg = "请输入关键字"
        })
        <span class="monk-iconfont border-left icon-monk-dacha monk-clear-input textarea-icon"></span>
    </div>
    <div class="monk-form-tip">SEO关键字，用英文逗号隔开，方法搜索引擎收录</div>
</div>
<div class="monk-form-item">
    <label for="Description" class="monk-form-label">系统描述</label>
    <div class="monk-form-wrap">
        <span class="monk-iconfont border-right icon-monk-input textarea-icon"></span>
        @Html.TextAreaFor(u => u.Description,
        new
        {
            @class = "monk-form-textarea normal",
            placeholder = "系统描述",
            datatype = "*1-160",
            ignore = "ignore",
            errormsg = "系统描述由1-160位英文字母、数字或符号组成",
            nullmsg = "请输入系统描述"
        })
        <span class="monk-iconfont border-left icon-monk-dacha monk-clear-input textarea-icon"></span>
    </div>
    <div class="monk-form-tip">简单一句话，描述一下该系统吧。</div>
</div>
<div class="monk-form-item">
    <label for="Support" class="monk-form-label">技术支持</label>
    <div class="monk-form-wrap">
        <span class="monk-iconfont border-right icon-monk-input"></span>
        @Html.TextBoxFor(u => u.Support,
        new
        {
            @class = "monk-form-input normal",
            disabled = "disabled",
            placeholder = "技术支持",
            ignore = "ignore",
            datatype = "*1-50",
            errormsg = "技术支持由6-20位英文字母、数字或符号组成",
            nullmsg = "请输入技术支持"
        })
    </div>
    <div class="monk-form-tip">毋庸置疑，只有创造她的人才更懂她~~</div>
</div>
<div class="monk-form-item">
    <label for="CopyRight" class="monk-form-label">版权所有</label>
    <div class="monk-form-wrap">
        <span class="monk-iconfont border-right icon-monk-input textarea-icon"></span>
        @Html.TextAreaFor(u => u.CopyRight,
        new
        {
            @class = "monk-form-textarea normal",
            placeholder = "版权所有",
            datatype = "*1-100",
            ignore = "ignore",
            errormsg = "版权所有由1-100位英文字母、数字或符号组成",
            nullmsg = "请输入版权所有"
        })
        <span class="monk-iconfont border-left icon-monk-dacha monk-clear-input textarea-icon"></span>
    </div>
    <div class="monk-form-tip">格式通常为：Copyright ©  2016 百签软件（中山）有限公司. All rights reserved.</div>
</div>
<div class="monk-form-item">
    <label for="Site" class="monk-form-label">官方网址</label>
    <div class="monk-form-wrap">
        <span class="monk-iconfont border-right icon-monk-input"></span>
        @Html.TextBoxFor(u => u.Site,
        new
        {
            @class = "monk-form-input normal",
            placeholder = "官方网址",
            datatype = "url",
            ignore = "ignore",
            errormsg = "请输入正确的网址",
            nullmsg = "请输入官方网址"
        })
        <span class="monk-iconfont border-left icon-monk-dacha monk-clear-input"></span>
    </div>
    <div class="monk-form-tip">写下你的官方网址，让大家多了解一下你。</div>
</div>
<div class="monk-form-item">
    <label for="PageSize" class="monk-form-label">默认页容量</label>
    <div class="monk-form-wrap">
        <span class="monk-iconfont border-right icon-monk-input"></span>
        @Html.TextBoxFor(u => u.PageSize,
        new
        {
            @class = "monk-form-input min",
            placeholder = "默认页容量",
            datatype = "n",
            errormsg = "页容量必须是正整数",
            nullmsg = "请输入默认页容量"
        })
        <span class="monk-iconfont icon-monk-required"></span>
        <span class="monk-iconfont border-left icon-monk-dacha monk-clear-input"></span>
    </div>
    <div class="monk-form-tip">指定一下默认的数据显示条数吧</div>
</div>
<div class="monk-form-item">
    <label for="ImageMaxSize" class="monk-form-label">图片最大上传大小（M）</label>
    <div class="monk-form-wrap">
        <span class="monk-iconfont border-right icon-monk-input"></span>
        @Html.TextBoxFor(u => u.ImageMaxSize,
        new
        {
            @class = "monk-form-input min",
            placeholder = "图片最大上传大小（M）",
            datatype = "num",
            errormsg = "只能输入数值类型",
            nullmsg = "请输入图片最大上传大小（M）"
        })
        <span class="monk-iconfont icon-monk-required"></span>
        <span class="monk-iconfont border-left icon-monk-dacha monk-clear-input"></span>
    </div>
    <div class="monk-form-tip">指定该数值可以显示用户上传图片的大小</div>
</div>
<div class="monk-form-item">
    <label for="VideoMaxSize" class="monk-form-label">视频最大上传大小（M）</label>
    <div class="monk-form-wrap">
        <span class="monk-iconfont border-right icon-monk-input"></span>
        @Html.TextBoxFor(u => u.VideoMaxSize,
        new
        {
            @class = "monk-form-input min",
            placeholder = "视频最大上传大小（M）",
            datatype = "num",
            errormsg = "只能输入数值类型",
            nullmsg = "请输入视频最大上传大小（M）"
        })
        <span class="monk-iconfont icon-monk-required"></span>
        <span class="monk-iconfont border-left icon-monk-dacha monk-clear-input"></span>
    </div>
    <div class="monk-form-tip">指定该数值可以显示用户上传视频的大小</div>
</div>
<div class="monk-form-item">
    <label for="AttachMaxSize" class="monk-form-label">附件最大上传大小（M）</label>
    <div class="monk-form-wrap">
        <span class="monk-iconfont border-right icon-monk-input"></span>
        @Html.TextBoxFor(u => u.AttachMaxSize,
        new
        {
            @class = "monk-form-input min",
            placeholder = "附件最大上传大小（M）",
            datatype = "num",
            errormsg = "只能输入数值类型",
            nullmsg = "请输入附件最大上传大小（M）"
        })
        <span class="monk-iconfont icon-monk-required"></span>
        <span class="monk-iconfont border-left icon-monk-dacha monk-clear-input"></span>
    </div>
    <div class="monk-form-tip">指定该数值可以显示用户上传附件的大小</div>
</div>


@section operate{
    @Html.HiddenFor(u => u.SetID)
    <input type="submit" class="monk-input-button turquoise monk-form-submit" value="提交保存">
    <input type="reset" class="monk-input-button amethyst monk-form-reset" value="重置表单">
    <input type="button" class="monk-input-button emerland monk-form-previous" value="返回前页" onclick="history.go(-1);">
}

@section endForm{@{ Html.EndForm();}}

@section foot{
    <script type="text/javascript">
        $(function () {
            backend.validform(function (data) {
            });

            // 初始化Web Uploader
            var uploader
                ,state="pending"
                ,$input=$("#Logo")
                ,$progress=$("#uploadProgress")
                ,$btn=$("#startUpload");
            uploader = WebUploader.create({
                // 选完文件后，是否自动上传。
                auto: false,
                // swf文件路径
                swf: '/Areas/Backend/Assets/Vendors/webuploader-v0.1.6/dist/Uploader.swf',
                // 文件接收服务端。
                server: '@Url.Action("UploadImage", "Common",new {area="Services" }) ',
                // 选择文件的按钮。可选。
                // 内部根据当前运行是创建，可能是input元素，也可能是flash.
                pick: {
                    id: '#selectFiles',
                    multiple: false
                },
                // 只允许选择图片文件。
                accept: {
                    title: '系统标志',
                    extensions: 'gif,jpg,jpeg,bmp,png',
                    mimeTypes: 'image/*'
                },
                compress: false,
                fileSizeLimit: @ViewBag.SysSetInfo.ImageMaxSize * 1024 * 1024
            });
            // 当有文件添加进来的时候
            uploader.on('fileQueued', function (file) {
                $input.val("等待上传："+file.name);
                $progress.css( 'width', '0%' );
            });
            // 文件上传过程中创建进度条实时显示。
            uploader.on( 'uploadProgress', function( file, percentage ) {
                $input.val("上传中："+file.name);
                $progress.css( 'width', percentage * 100 + '%' );
            });
            uploader.on( 'uploadSuccess', function( file,response) {
                backend.successTip("上传成功");
            });
            uploader.on( 'uploadError', function( file,reason) {
                backend.errorTip("上传出错");
            });
            uploader.on( 'uploadComplete', function( file ) {
                $progress.css( 'width', '0%' );
            });
            uploader.on( 'startUpload', function() {
                if(uploader.getStats().queueNum==0){
                    backend.errorTip("没有检测到文件");
                }
            });
            uploader.on( 'error', function(type) {
                if(type=="Q_TYPE_DENIED"){
                    backend.errorTip("不支持该文件类型");
                }
                else if(type=="Q_EXCEED_SIZE_LIMIT"){
                    backend.errorTip("该文件超过最大限制：@ViewBag.SysSetInfo.ImageMaxSize M");
                }
                else if(type=="Q_EXCEED_NUM_LIMIT"){
                    backend.errorTip("选择文件的总数已超过可选的大小");
                }
            });
            // 监听上传所有状态
            uploader.on( 'all', function(type) {
                if ( type === 'startUpload' ) {
                    state = 'uploading';
                } else if ( type === 'stopUpload' ) {
                    state = 'paused';
                } else if ( type === 'uploadFinished' ) {
                    state = 'done';
                }
                if ( state === 'uploading' ) {
                    $input.val($input.val().replace("上传中：","暂停上传："));
                    $btn.text('暂停上传');
                } else {
                    $btn.text('开始上传');
                }
            });
            // 开始上传
            $btn.on( 'click', function() {
                if ( state === 'uploading' ) {
                    uploader.stop();
                } else {
                    uploader.upload();
                }
            });
        });
    </script>
}